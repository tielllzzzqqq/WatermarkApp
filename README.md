# WatermarkApp

一个在 macOS 上运行的本地水印应用，专注于“非高级功能”的首版实现：支持批量导入图片、实时预览文本水印、九宫格位置与手动拖拽定位、导出为 PNG/JPEG，以及模板保存与加载。

以下 README 按最初需求梳理基础功能，并补充安装、运行、打包说明。

## 安装与运行

- 建议使用虚拟环境（避免系统环境受管控导致安装失败，符合 PEP 668）：
  - `python3 -m venv .venv`
  - `source .venv/bin/activate`
  - `python -m pip install -r requirements.txt`
  - 运行应用：`.venv/bin/python main.py`
- Qt 绑定兼容：优先使用 `PyQt5`，自动回退到 `PySide6`（只需安装其一即可）。

## 打包为 macOS 应用

- 使用 PyInstaller（项目已包含 `pyinstaller`）：
  - 生成 `.app`：
    - `.venv/bin/pyinstaller --windowed --name WatermarkApp --icon resources/icon.svg main.py`
    - 产物位于 `dist/WatermarkApp.app`
  - 生成可分发目录：
    - `.venv/bin/pyinstaller --windowed --onedir --name WatermarkApp --icon resources/icon.svg main.py`
  - 如需 DMG，可使用第三方打包工具或脚本（项目中可能已有 `dist/WatermarkApp.dmg` 示例）。

## 基础功能（非高级功能）

### 1. 文件处理
- 导入图片：
  - 支持拖拽单张或通过文件选择器导入。
  - 支持批量导入（一次选择多张或导入整个文件夹）。
  - 在界面左侧显示已导入图片列表（缩略图＋文件名）。

### 1.2 支持格式
- 输入格式：支持主流格式 JPEG、PNG，并支持 BMP、TIFF。
- PNG 支持透明通道。
- 输出格式：支持导出为 JPEG 或 PNG。

### 1.3 导出图片
- 用户可选择输出文件夹；为防止覆盖原图，默认禁止导出到原文件夹。
- 提供导出命名规则：
  - 保留原文件名。
  - 添加自定义前缀（如 `wm_`）。
  - 添加自定义后缀（如 `_watermarked`）。
- 注：JPEG 质量调节与导出缩放为可选高级功能，当前版本未实现。

### 2. 水印类型
- 文本水印：
  - 内容：用户可自定义输入任意文本。
  - 透明度：支持 0–100% 调节。
  - 注：字体选择、颜色调色板、阴影/描边为可选高级功能，当前版本未实现。
- 图片水印：可选高级功能，当前版本未实现（计划支持 PNG 透明、缩放与透明度）。

### 3. 水印布局与样式
- 实时预览：
  - 所有水印设置变更会在右侧预览区实时显示。
  - 点击左侧列表可切换预览不同图片。
- 位置：
  - 预设位置（九宫格）：四角、边中、中心一键放置。
  - 手动拖拽：在预览图上按住鼠标左键拖动水印到任意位置。
  - 九宫格选择与拖拽可互相覆盖，交互自然。拖拽采用文本中心对齐并带边界约束，防止拖出图像。
- 注：旋转为可选高级功能，当前版本未实现。

### 4. 配置管理
- 水印模板：
  - 可保存当前水印设置为模板（内容、位置、透明度、命名规则等参数）。
  - 支持加载、管理已保存模板。
  - 程序启动时自动加载上次关闭时的设置或默认模板。
- 模板与设置保存位置：
  - `~/.watermark_app/settings.json`（用户主目录下）。
  - `templates` 字段存储模板列表。

## 使用说明（基础版）

- 导入图片：
  - 点击“导入图片”或“导入文件夹”，或将图片拖拽到应用内导入区域。
  - 左侧列表显示缩略图与文件名，点击项即可切换预览。
- 设置水印：
  - 输入“水印文本”，调整“透明度”。
  - 在“水印位置”中点击九宫格位置，或直接在预览区拖拽文本到目标位置。
- 导出图片：
  - 在“输出设置”选择格式（PNG/JPEG），设置命名规则（原名、前缀、后缀）。
  - 选择输出文件夹后执行导出（默认不允许导出到原文件夹以防覆盖）。
- 模板管理：
  - “保存当前设置为模板”将参数写入模板列表。
  - “加载模板”可快速应用既有模板。

## 兼容性与显示优化

- macOS 高 DPI：在应用创建前启用高 DPI 属性，预览与界面缩放更清晰。
- 右侧内容滚动：预览与设置区域包裹在 `QScrollArea` 中，窗口变窄时内容不会被挤压。
- 预览区域自适应：`preview_label` 使用扩展尺寸策略，窗口扩大时自然扩展，缩小时保持可用。

## 后续可选高级功能（规划）

- 文本水印：字体选择、颜色调色板、阴影/描边样式。
- 图片水印：支持 PNG 透明、缩放与透明度。
- 导出增强：JPEG 质量滑块、导出尺寸缩放（按宽/高或百分比）。
- 布局增强：水印旋转角度调节。

如需继续完善高级功能或调整交互细节（如固定预览比例、精确定位辅助线等），欢迎提出你的具体偏好，我会按你的方向迭代。